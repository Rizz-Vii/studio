# ğŸ§  AI IDE INSTRUCTION PROMPT: Build AI Chatbot for SEO SaaS (RankPilot)

## ğŸš€ Objective

Develop a modular, intelligent chatbot that:

- Uses Firestore-stored SEO audits and website content
- Answers SEO-related queries based on real data
- Lives within a modern React front-end
- Is powered by a Firebase Callable Function
- Follows high-performance, secure, and scalable architecture principles

---

## ğŸ“ Firestore Database Structure

Please use this Firestore schema:

users/{uid}
â””â”€â”€ profile: { name, email, plan }

audits/{uid}/urls/{urlId}
â”œâ”€â”€ score: { performance, accessibility, seo, ... }
â”œâ”€â”€ issues: [string]
â””â”€â”€ suggestions: [string]

siteContent/{uid}/pages/{slug}
â”œâ”€â”€ html: "<...>"
â”œâ”€â”€ text: "Extracted visible text"
â””â”€â”€ embeddings: [number]

chatLogs/{uid}/sessions/{sessionId}
â””â”€â”€ { timestamp, question, response }

faq/{topic}
â””â”€â”€ { question, answer }

yaml
Copy code

Ensure `chatLogs` can support conversation persistence.

---

## ğŸ”„ Context Fetchers (Node / TypeScript)

Create a utility file at `src/ai/context.ts`:

- `getAuditContext(uid: string, url: string)`: Fetches top audit scores, issues, and suggestions.
- `getSiteContext(uid: string)`: Aggregates plain text from all pages for context injection into LLM prompts.

Make this modular, cache-aware (memoized where possible), and typed.

---

## ğŸ”¥ Firebase Callable Function

Create `functions/chatbot.ts`:

- Callable via `chatbotHandler`
- Receives: `{ uid, message, url }`
- Uses `getAuditContext` + `getSiteContext` to construct a system + user prompt
- Calls OpenAI/Claude with this full context
- Returns structured response
- Log each chat into `chatLogs/{uid}/sessions/{sessionId}`

Follow best practices:

- Use try/catch
- Validate `uid` and `url`
- Handle empty context gracefully

---

## ğŸ’¬ React ChatBot UI Component

Create `components/ChatBot.tsx`:

- Floating button: "ğŸ’¬ Ask RankPilot"
- Opens a side drawer (use `shadcn/ui` or headless-ui)
- Shows history and AI responses
- Sends user input to `/api/chatbot` (or Firebase callable proxy)
- Displays `thinking...` while waiting
- Scrolls to bottom on new message
- Fully accessible + keyboard friendly

Use:

- `useEffect` for auto-scroll
- `useState` for conversation state
- Animate replies with framer-motion if available

---

## âœ… Additional Technical Instructions

- Use **modular file structure** (utils, components, functions)
- Ensure **secure rules** in Firestore access (auth-based document access only)
- Use **TypeScript** with proper types and `zod` or `yup` for validation
- Keep network calls cancellable and error-resilient
- Maintain **strict memory control** on client (limit long chat history loads)
- Respect OpenAI rate limits and token budgets when fetching long contexts

---

## ğŸ§  Prompt Template (LLM)

```txt
System:
You are RankPilot, an AI SEO assistant. Help the user by using real SEO audits and their site content.

Audit:
{{ audit.score }}
Issues:
{{ audit.issues }}

Site Context:
{{ siteContext }}

User:
{{ message }}
